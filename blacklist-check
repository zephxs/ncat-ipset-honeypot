#!/bin/bash
#set -x
IP1=$@
# find all blacklist set in IPSET and write them in a text file
ipset list -n >/root/blacklist/ipset-list

_ISANIP(){
/usr/local/bin/_ISIP $IP1 || exit 1
if [[ "$IP1" =~ ^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$ ]]; then
  _IPRC=0
else
  exit 1
fi
}

_ISINBL(){
for _LST in $(cat /root/blacklist/ipset-list); do 
  if ipset test $_LST $IP1; then exit 1; fi
done
}

# Search for IP address in every blacklist configured in IPSET and exit 0 for scripts
_ISANIP
_ISINBL

#[ "$_RC" = 0 -a "$_IPRC" = 0 ] && exit 0
exit 0
